<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example • BACps</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example">
<meta property="og:description" content="BACps">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BACps</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Example.html">Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example</h1>
            
      
      
      <div class="hidden name"><code>Example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BACps</span><span class="op">)</span></code></pre></div>
<div id="example-simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-simulated-data" class="anchor"></a>Example: Simulated Data</h2>
<p>The simulated data can be generated using the function <strong>sim_data</strong> where the first argument is the sample size and the second one is the exposure effect (conditional) on the outcome. we generate a data of sample size equal to 1000 and an exposure effect of 0.3.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">BACps</span><span class="fu">::</span><span class="fu"><a href="../reference/sim_data.html">sim_data</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">.3</span><span class="op">)</span></code></pre></div>
<p>is a list where the first item is the outcome, the second one is the exposure and the last one is the set of covariates. The binary exposure is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="va">sim_data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>The binary outcome is:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">=</span> <span class="va">sim_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>and the five covariates are:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">U</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Let’s run our procedure BACps with dependence parameter (w) equal to 50. This parameter governs the relationship between the prognostic score and propensity score. If the dependence parameter is equal to 1, there is no information flowing between both models. So, w=1 corresponds to an uninformative prior for the model indicator of the propensity score.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_bacps</span> <span class="op">=</span> <span class="fu">BACps</span><span class="fu">::</span><span class="fu"><a href="../reference/bacps.html">bacps</a></span><span class="op">(</span>w<span class="op">=</span><span class="fl">50</span>,x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,U<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span>, niter_1st<span class="op">=</span><span class="fl">1000</span>, niter_2nd<span class="op">=</span><span class="fl">1500</span>, burnin_1st<span class="op">=</span><span class="fl">500</span>, burnin_2nd<span class="op">=</span><span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; [1] "acceptation ratio of parameter alpha:"</span>
<span class="co">#&gt; [1] 0.173</span>
<span class="co">#&gt; [1] "First Stage Done!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    4.70    0.05    4.75 </span>
<span class="co">#&gt;            </span>
<span class="co">#&gt; 0.01333333 </span>
<span class="co">#&gt; [1] "2nd Stage Done!"</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   61.28    0.02   61.41</span></code></pre></div>
<p>The average causal effect (conditional) is:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_bacps</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; [1] 0.2156282</span></code></pre></div>
<p>The posterior probability on the model indicator variable is:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_bacps</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt;                 post.alphaX</span>
<span class="co">#&gt; 6   6 1 0 1 0 0 0.022977023</span>
<span class="co">#&gt; 10 10 1 0 0 1 0 0.007992008</span>
<span class="co">#&gt; 14 14 1 0 1 1 0 0.969030969</span></code></pre></div>
<p>The informative prior distribution on the model indicator of the propensity score used in the second stage (which is a posterior probability in the first stage):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_bacps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt;       &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; post.alphaX|Y</span>
<span class="co">#&gt;  [1,]    0    0    0    0    1   0.024954233</span>
<span class="co">#&gt;  [2,]    0    0    0    1    0   0.092569942</span>
<span class="co">#&gt;  [3,]    0    0    0    1    1   0.024954233</span>
<span class="co">#&gt;  [4,]    0    0    1    0    0   0.092569942</span>
<span class="co">#&gt;  [5,]    0    0    1    0    1   0.024954233</span>
<span class="co">#&gt;  [6,]    0    0    1    1    0   0.092569942</span>
<span class="co">#&gt;  [7,]    0    0    1    1    1   0.024954233</span>
<span class="co">#&gt;  [8,]    0    1    0    0    0   0.015525574</span>
<span class="co">#&gt;  [9,]    0    1    0    0    1   0.003521494</span>
<span class="co">#&gt; [10,]    0    1    0    1    0   0.015525574</span>
<span class="co">#&gt; [11,]    0    1    0    1    1   0.003521494</span>
<span class="co">#&gt; [12,]    0    1    1    0    0   0.015525574</span>
<span class="co">#&gt; [13,]    0    1    1    0    1   0.003521494</span>
<span class="co">#&gt; [14,]    0    1    1    1    0   0.015525574</span>
<span class="co">#&gt; [15,]    0    1    1    1    1   0.003521494</span>
<span class="co">#&gt; [16,]    1    0    0    0    0   0.092569942</span>
<span class="co">#&gt; [17,]    1    0    0    0    1   0.024954233</span>
<span class="co">#&gt; [18,]    1    0    0    1    0   0.092569942</span>
<span class="co">#&gt; [19,]    1    0    0    1    1   0.024954233</span>
<span class="co">#&gt; [20,]    1    0    1    0    0   0.092569942</span>
<span class="co">#&gt; [21,]    1    0    1    0    1   0.024954233</span>
<span class="co">#&gt; [22,]    1    0    1    1    0   0.092569942</span>
<span class="co">#&gt; [23,]    1    0    1    1    1   0.024954233</span>
<span class="co">#&gt; [24,]    1    1    0    0    0   0.015525574</span>
<span class="co">#&gt; [25,]    1    1    0    0    1   0.003521494</span>
<span class="co">#&gt; [26,]    1    1    0    1    0   0.015525574</span>
<span class="co">#&gt; [27,]    1    1    0    1    1   0.003521494</span>
<span class="co">#&gt; [28,]    1    1    1    0    0   0.015525574</span>
<span class="co">#&gt; [29,]    1    1    1    0    1   0.003521494</span>
<span class="co">#&gt; [30,]    1    1    1    1    0   0.015525574</span>
<span class="co">#&gt; [31,]    1    1    1    1    1   0.003521494</span></code></pre></div>
<p>The posterior distribution of the model indicators of the prognostic score model which is used to compute the posterior distribution of the model indicator of the propensity score model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_bacps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt;      00000      00001      00010      00011      00100      00101      00110 </span>
<span class="co">#&gt; 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 </span>
<span class="co">#&gt;      00111      01000      01001      01010      01011      01100      01101 </span>
<span class="co">#&gt; 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 </span>
<span class="co">#&gt;      01110      01111      10000      10001      10010      10011      10100 </span>
<span class="co">#&gt; 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 </span>
<span class="co">#&gt;      10101      10110      10111      11000      11001      11010      11011 </span>
<span class="co">#&gt; 0.00000000 0.44111776 0.30938124 0.00000000 0.00000000 0.00000000 0.00000000 </span>
<span class="co">#&gt;      11100      11101      11110      11111 </span>
<span class="co">#&gt; 0.00000000 0.00000000 0.16566866 0.08383234</span></code></pre></div>
<p>As a comparator, let’s run a penalized logistic regression (LASSO) forcing the exposure variable to be always in the model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu">glmnet</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; Loaded glmnet 4.1-1</span>
<span class="va">data_glm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">U</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Choose Constrained Coefficients so we force the exposure to always be in the model</span>
<span class="va">lb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span> <span class="va">data_glm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span> <span class="va">data_glm</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ub</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fl">0</span> <span class="co"># so there is no penalization on the exposure variable</span>
<span class="va">cv.lasso</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data_glm</span><span class="op">)</span>,y<span class="op">=</span><span class="va">y</span>,lower.limits <span class="op">=</span> <span class="va">lb</span>, upper.limits <span class="op">=</span> <span class="va">ub</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
<span class="co"># Fit the final model on the training data</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html">glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data_glm</span><span class="op">)</span>,y<span class="op">=</span><span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,lambda <span class="op">=</span> <span class="va">cv.lasso</span><span class="op">$</span><span class="va">lambda.min</span><span class="op">)</span>
<span class="co"># Display regression coefficients</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; 7 x 1 sparse Matrix of class "dgCMatrix"</span>
<span class="co">#&gt;                       s0</span>
<span class="co">#&gt; (Intercept) -0.097842570</span>
<span class="co">#&gt; x            0.671696930</span>
<span class="co">#&gt; X1           0.863977810</span>
<span class="co">#&gt; X2          -0.109517966</span>
<span class="co">#&gt; X3           0.978955338</span>
<span class="co">#&gt; X4           1.009557141</span>
<span class="co">#&gt; X5           0.007174902</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Pablo Gonzalez Ginestet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
